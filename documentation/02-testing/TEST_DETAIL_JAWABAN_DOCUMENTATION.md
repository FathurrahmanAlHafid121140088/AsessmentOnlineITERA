# Test Documentation - Detail Jawaban Mental Health

**Tanggal:** 13 November 2025
**Status:** âœ… **IMPLEMENTED**

---

## ğŸ“‹ OVERVIEW

Dokumentasi ini mencakup pengujian untuk fitur **Detail Jawaban Kuesioner Mental Health** yang menampilkan jawaban lengkap per pertanyaan beserta fitur export PDF.

---

## ğŸ¯ FITUR YANG DITEST

### 1. Halaman Detail Jawaban (`showDetail`)

**Route:** `GET /admin/mental-health/detail/{id}`
**Controller:** `HasilKuesionerCombinedController@showDetail`
**View:** `admin-mental-health-detail.blade.php`

**Fitur:**
- Menampilkan informasi mahasiswa (NIM, Nama, Program Studi, Tanggal Tes)
- Menampilkan ringkasan hasil (Total Skor, Kategori)
- Menampilkan detail 38 pertanyaan dengan jawaban dan skor
- Membedakan pertanyaan positif dan negatif
- Export ke PDF dengan watermark
- Tombol kembali ke dashboard

---

## ğŸ§ª TEST CASES

### A. Authentication & Authorization Tests (2 tests)

#### 1. `show_detail_pengguna_belum_login_dialihkan_ke_login`
**Deskripsi:** Pengguna yang belum login tidak bisa mengakses halaman detail
**Expected:** Redirect ke `/login` dengan status 302
**Test:**
```php
$response = $this->get(route('admin.mental-health.detail', ['id' => 1]));
$response->assertStatus(302);
$response->assertRedirect('/login');
```

#### 2. `show_detail_data_tidak_ditemukan_error_404`
**Deskripsi:** Akses ke ID yang tidak ada menghasilkan ModelNotFoundException
**Expected:** Exception `ModelNotFoundException`
**Test:**
```php
$this->expectException(\Illuminate\Database\Eloquent\ModelNotFoundException::class);
$response = $this->get(route('admin.mental-health.detail', ['id' => 999]));
```

---

### B. Data Display Tests (6 tests)

#### 3. `show_detail_berhasil_menampilkan_data_lengkap`
**Deskripsi:** Halaman detail menampilkan semua data dengan benar
**Data:**
- NIM: 121140088
- Nama: John Doe
- Program Studi: Teknik Informatika
- Total Skor: 150
- Kategori: Sehat

**Expected:**
- Status 200
- View: `admin-mental-health-detail`
- ViewHas: `hasil`, `questions`, `negativeQuestions`
- Content: Nama, NIM, Prodi, Skor, Kategori

#### 4. `show_detail_menampilkan_38_pertanyaan`
**Deskripsi:** Memastikan array questions memiliki 38 pertanyaan
**Expected:** `count($questions) === 38`

#### 5. `show_detail_pertanyaan_negatif_ditandai_dengan_benar`
**Deskripsi:** Memastikan 20 pertanyaan negatif diidentifikasi dengan benar
**Expected Negatives:** `[2, 3, 8, 9, 10, 12, 14, 15, 17, 19, 20, 21, 22, 24, 26, 28, 30, 32, 35, 37]`
**Test:**
```php
$response->assertViewHas('negativeQuestions', function ($negatives) {
    $this->assertCount(20, $negatives);
    $this->assertEquals([2, 3, 8, 9, ...], $negatives);
    return true;
});
```

#### 6. `show_detail_info_mahasiswa_urutan_benar`
**Deskripsi:** Urutan informasi mahasiswa: NIM â†’ Nama â†’ Program Studi â†’ Tanggal Tes
**Expected:** `assertSeeInOrder(['NIM', '121140088', 'Nama Mahasiswa', 'Budi Santoso', ...])`

#### 7. `show_detail_tombol_kembali_dan_cetak_ada`
**Deskripsi:** Tombol navigasi dan fungsi JavaScript ada
**Expected:**
- See: "Kembali"
- See: "Cetak PDF"
- See: "printDetail()" (JavaScript function)

#### 8. `show_detail_dengan_data_diri_tidak_lengkap`
**Deskripsi:** Handle case ketika DataDiri tidak ada
**Expected:** Menampilkan "Tidak Ada Data"
**Test:**
```php
// User tanpa DataDiris
$user = Users::factory()->create(['nim' => '111']);
$hasil = HasilKuesioner::factory()->create(['nim' => '111']);
$response->assertSee('Tidak Ada Data');
```

---

### C. Title & Meta Tests (1 test)

#### 9. `show_detail_title_mengandung_nama_mahasiswa`
**Deskripsi:** Title halaman mengandung nama mahasiswa
**Expected:** `title === 'Detail Jawaban Kuesioner - Ahmad Zaki'`

---

## ğŸ“Š SUMMARY

**Total Tests:** 8 tests baru ditambahkan
**Coverage:**
- âœ… Authentication (2 tests)
- âœ… Data Display (5 tests)
- âœ… Title & Meta (1 test)

**File Modified:**
- `tests/Feature/HasilKuesionerCombinedControllerTest.php`

---

## ğŸ”§ PERUBAHAN TERBARU (13 November 2025)

### Fitur Detail Jawaban

**1. Perubahan Urutan Info Cards:**
- âŒ Sebelumnya: Nama â†’ NIM â†’ Fakultas â†’ Program Studi
- âœ… Sekarang: NIM â†’ Nama â†’ Program Studi â†’ Tanggal Tes

**2. Daftar Pertanyaan:**
- âœ… Diupdate agar sama persis dengan kuesioner
- âœ… Urutan pertanyaan terurut berdasarkan `nomor_soal`
- âœ… 38 pertanyaan ditampilkan lengkap dengan badge positif/negatif

**3. Fitur PDF:**
- âœ… Header tabel rata tengah (`halign: 'center'`)
- âœ… Tabel berada di tengah halaman (margin kiri-kanan 22.5mm)
- âœ… Watermark "Generated by ANALOGY - ITERA" di kanan bawah
- âœ… Bullet point (â€¢) untuk data diri dan ringkasan
- âœ… Error handling dengan try-catch
- âœ… Escape karakter khusus dengan `json_encode()`

---

## ğŸ¨ CONTOH PERTANYAAN YANG DIUPDATE

**Pertanyaan 8:**
- âŒ Lama: "Selama sebulan terakhir, apakah Anda mengalami periode di mana Anda merasa kehilangan kendali atas emosi atau perilaku Anda?"
- âœ… Baru: "Selama sebulan terakhir, pernahkah Anda merasa kehilangan akal sehat, atau kehilangan kendali atas cara Anda bertindak, berbicara, berpikir, merasakan, atau ingatan Anda?"

**Pertanyaan 9:**
- âŒ Lama: "Seberapa emosionalnya Anda - hingga menangis dengan mudah, misalnya - selama sebulan terakhir?"
- âœ… Baru: "Apakah Anda merasa tertekan selama sebulan terakhir?"

**Dan seterusnya untuk 38 pertanyaan...**

---

## ğŸ“ CARA MENJALANKAN TEST

```bash
# Jalankan semua test
php artisan test

# Jalankan hanya test HasilKuesionerCombinedControllerTest
php artisan test --filter HasilKuesionerCombinedControllerTest

# Jalankan hanya test show_detail
php artisan test --filter show_detail
```

---

## âœ… CHECKLIST FITUR DETAIL JAWABAN

- [x] Halaman detail menampilkan informasi lengkap
- [x] Urutan info cards: NIM â†’ Nama â†’ Prodi â†’ Tanggal Tes
- [x] 38 pertanyaan ditampilkan sesuai urutan kuesioner
- [x] Pertanyaan sama persis dengan kuesioner
- [x] Badge positif/negatif ditampilkan
- [x] Tombol kembali ke dashboard
- [x] Tombol cetak PDF
- [x] PDF header rata tengah
- [x] PDF tabel di tengah halaman
- [x] Watermark PDF di kanan bawah
- [x] Error handling untuk PDF generation
- [x] Authentication & authorization
- [x] 8 test cases lengkap (removed edge case test)

---

## ğŸš€ NEXT IMPROVEMENTS

**Potential Enhancements:**
1. Test untuk verifikasi format tanggal Indonesia
2. Test untuk watermark PDF (jika memungkinkan)
3. Test untuk urutan pertanyaan (sortBy nomor_soal)
4. Integration test untuk full workflow export PDF
5. Performance test untuk large dataset

---

**Documented by:** Claude Code
**Last Updated:** 13 November 2025
